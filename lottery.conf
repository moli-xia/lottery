local app_id="lottery"
local app_name="魔力彩票助手（Lottery Prediction Assistant）"
local app_text="抓取历史开奖 + LLM 分析，支持 ssq/dlt，含后台配置与测试"
local app_url="https://github.com/moli-xia/lottery"
local docker_name="lottery"
local docker_port="8888"
local app_size="1"

docker_app_install() {
    mkdir -p /home/docker/lottery && cd /home/docker/lottery
    mkdir -p data

    curl -L -o docker-compose.yml "${gh_proxy}https://raw.githubusercontent.com/moli-xia/lottery/main/docker-compose.yml"
    sed -i "s/8888:8888/${docker_port}:8888/g" docker-compose.yml
    sed -i "s/^\\([[:space:]]*container_name:\\).*/\\1 ${docker_name}/g" docker-compose.yml

    if [ ! -f .env ]; then
        local secret=""
        if command -v openssl >/dev/null 2>&1; then
            secret="$(openssl rand -hex 32)"
        else
            secret="$(date +%s)-$RANDOM-$RANDOM"
        fi
        printf "SESSION_SECRET=%s\n" "$secret" > .env
    fi

    docker compose up -d
    echo "安装完成 / Install Complete"
    check_docker_app_ip
}

docker_app_update() {
    cd /home/docker/lottery
    curl -L -o docker-compose.yml "${gh_proxy}https://raw.githubusercontent.com/moli-xia/lottery/main/docker-compose.yml"
    sed -i "s/8888:8888/${docker_port}:8888/g" docker-compose.yml
    sed -i "s/^\\([[:space:]]*container_name:\\).*/\\1 ${docker_name}/g" docker-compose.yml
    docker compose pull
    docker compose up -d
    echo "更新完成 / Update Complete"
}

docker_app_uninstall() {
    cd /home/docker/lottery
    docker compose down --rmi all
    rm -rf /home/docker/lottery
    echo "卸载完成 / Uninstall Complete"
}

docker_app_plus
